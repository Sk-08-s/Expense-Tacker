<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/api-handler.js"></script>
<script src="js/transaction-handler.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .header {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .header img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            vertical-align: middle;
        }

        .header h1 {
            color: white;
            display: inline-block;
            margin: 0;
            vertical-align: middle;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
        }

        .welcome-banner {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .welcome-banner h2 {
            color: #333;
            margin: 0 0 10px 0;
        }

        .key-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-card h3 {
            color: #333;
            margin: 0 0 10px 0;
        }

        .metric-card .amount {
            font-size: 24px;
            font-weight: bold;
            color: #764ba2;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .recent-transactions {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .transactions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .transactions-table th,
        .transactions-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .transactions-table th {
            background-color: #f8f9fa;
            color: #333;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .action-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-5px);
        }

        .action-card i {
            font-size: 24px;
            color: #764ba2;
            margin-bottom: 10px;
        }

        .progress-bar {
            background-color: #f0f0f0;
            border-radius: 10px;
            height: 10px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 10px;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .footer {
    text-align: center;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    color: white;
    margin-top: 40px;
}

.footer p {
    margin: 0 0 15px 0;
}

.footer-links {
    display: flex;
    justify-content: center;
    gap: 20px;
}

.footer a {
    color: white;
    text-decoration: none;
    transition: opacity 0.3s ease;
}

.footer a:hover {
    opacity: 0.8;
    text-decoration: underline;
}

@media (max-width: 768px) {
    .footer-links {
        flex-direction: column;
        gap: 10px;
    }
}
/* Add to your existing style section */
.chatbot-container {
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 300px;
    height: 400px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    display: none;
    flex-direction: column;
    z-index: 1000;
}

.chatbot-header {
    padding: 15px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 10px 10px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chatbot-header button {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
}

.chatbot-messages {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
}

.message {
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 10px;
    max-width: 80%;
}

.bot-message {
    background: #f0f0f0;
    margin-right: auto;
}

.user-message {
    background: #667eea;
    color: white;
    margin-left: auto;
}

.chatbot-input {
    padding: 15px;
    border-top: 1px solid #eee;
    display: flex;
    gap: 10px;
}

.chatbot-input input {
    flex: 1;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
    outline: none;
}

.chatbot-input button {
    background: #764ba2;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s ease;
}

.chatbot-input button:hover {
    background: #667eea;
}

.chatbot-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    z-index: 1000;
}

.chatbot-toggle i {
    color: white;
    font-size: 20px;
}

.add-expense-form {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    color: #333;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.submit-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.expense-list {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

#expenseTable {
    width: 100%;
    border-collapse: collapse;
}

#expenseTable th,
#expenseTable td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.delete-btn {
    background: #ff4444;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.delete-btn:hover {
    background: #cc0000;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    z-index: 1000;
}

.modal-content {
    background: white;
    margin: 10% auto;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    position: relative;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.close-modal {
    font-size: 28px;
    font-weight: bold;
    color: #666;
    cursor: pointer;
}

.close-modal:hover {
    color: #333;
}
/* Add or update these CSS styles */
    body {
        font-family: 'Arial', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        overflow-x: hidden; /* Prevent horizontal scroll */
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        box-sizing: border-box;
    }

    /* Key metrics section */
    .key-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    /* Chart container */
    .chart-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        height: 400px; /* Fixed height */
        overflow: hidden; /* Prevent overflow */
    }

    /* Recent transactions table */
    .transactions-table {
        width: 100%;
        overflow-x: auto; /* Allow horizontal scroll for table if needed */
        margin-bottom: 30px;
    }

    .transactions-table table {
        width: 100%;
        min-width: 600px; /* Minimum width to prevent squishing */
    }

    /* Action cards */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .container {
            padding: 10px;
        }

        .key-metrics {
            grid-template-columns: 1fr;
        }

        .chart-card {
            height: 300px; /* Smaller height on mobile */
        }

        .transactions-table {
            margin: 0 -10px; /* Negative margin to allow full-width scroll */
            padding: 0 10px;
        }
    }

    /* Footer */
    .footer {
        margin-top: auto;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        text-align: center;
    }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://i.ibb.co/X2BYFDs/logo.jpg" alt="Expense Tracker Logo">
        <h1>Expense Tracker</h1>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div class="dashboard-container" role="main">
        <div role="alert" aria-live="polite" id="notification-container"></div>
        <div class="welcome-banner">
            <h2>Welcome, <span id="user-name">User</span>!</h2>
            <p>Current Date: <span id="current-date"></span></p>
        </div>

        <div class="key-metrics">
            <div class="metric-card">
                <h3>Total Income</h3>
                <p id="total-income">‚Çπ0</p>
            </div>
            <div class="metric-card">
                <h3>Total Expenses</h3>
                <p id="total-expenses">‚Çπ0</p>
            </div>
            <div class="metric-card">
                <h3>Balance</h3>
                <p id="remaining-balance">‚Çπ0</p>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-card">
                <h3>Expense Breakdown Chart</h3>
                <canvas id="expense-chart"></canvas>
            </div>
            <div class="chart-card">
                <h3>Monthly Trend</h3>
                <canvas id="trend-chart" style="height: 300px;"></canvas>
            </div>
        </div>

        <div class="recent-transactions">
            <h3>Recent Transactions</h3>
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Category</th>
                        <th>Type</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="recent-transactions-body">
                    <!-- Recent transactions will be loaded here dynamically -->
                </tbody>
            </table>
        </div>

        <div class="quick-actions">
            <a href="addexpen.html" class="action-card" role="button" aria-label="Add new expense" tabindex="0">
                <div class="action-icon">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                </div>
                <h3>Add Expense</h3>
                <p>Record a new expense</p>
            </a>

            <a href="analytic.html" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-chart-pie"></i>
                </div>
                <h3>View Analytics</h3>
                <p>See spending patterns</p>
            </a>

            <a href="repo.html" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-download"></i>
                </div>
                <h3>Download Report</h3>
                <p>Export your data</p>
            </a>

            <a href="setting.html" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <h3>Settings</h3>
                <p>Manage your account</p>
            </a>
        </div>
    </div>

        

      

<!-- Add this table to display expenses -->




<!-- Add this CSS to style the form and table -->

    <div class="footer">
        <p>¬© 2024 Expense Tracker</p>
        <div class="footer-links">
            <a href="privacy.html">Privacy Policy</a>
            <a href="terms.html">Terms of Service</a>
            <a href="dashboard.html">Dashboard</a>
        </div>
    </div>
    <!-- Add this JavaScript to handle the form submission and display -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const expenseForm = document.getElementById('expenseForm');
        const expenseTableBody = document.getElementById('expenseTableBody');
        
        // Load existing expenses from localStorage
        loadExpenses();
    
        expenseForm.addEventListener('submit', function(e) {
            e.preventDefault();
    
            // Get form values
            const expense = {
                id: Date.now(), // Unique ID for each expense
                amount: document.getElementById('expenseAmount').value,
                category: document.getElementById('expenseCategory').value,
                date: document.getElementById('expenseDate').value,
                description: document.getElementById('expenseDescription').value
            };
    
            // Save expense
            saveExpense(expense);
    
            // Add to table
            addExpenseToTable(expense);
    
            // Reset form
            expenseForm.reset();
        });
    
        function saveExpense(expense) {
            let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
            const transaction = {
                ...expense,
                type: 'expense'
            };
            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            updateMetrics();
            updateExpenseChart();
            updateRecentTransactions();
        }
    
        function loadExpenses() {
            const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
            const expenses = transactions.filter(t => t.type === 'expense');
            expenses.forEach(expense => addExpenseToTable(expense));
            updateMetrics();
            updateExpenseChart();
            updateRecentTransactions();
        }
    
        function addExpenseToTable(expense) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${formatDate(expense.date)}</td>
                <td>${expense.category}</td>
                <td>${expense.description}</td>
                <td>‚Çπ${parseFloat(expense.amount).toLocaleString('en-IN')}</td>
                <td>
                    <button onclick="deleteExpense(${expense.id})" class="delete-btn">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            expenseTableBody.insertBefore(row, expenseTableBody.firstChild);
        }
    
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-IN', options);
        }
    
        window.deleteExpense = function(id) {
            let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
            transactions = transactions.filter(t => t.id !== id);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            // Refresh all views
            expenseTableBody.innerHTML = '';
            const expenses = transactions.filter(t => t.type === 'expense');
            expenses.forEach(expense => addExpenseToTable(expense));
            updateMetrics();
            updateExpenseChart();
            updateRecentTransactions();
        }
    
        function updateTotalExpenses() {
            const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
            const expenses = transactions.filter(t => t.type === 'expense');
            const total = expenses.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);
            
            // Update total in the metrics section
            const totalExpenseElement = document.getElementById('total-expenses');
            if (totalExpenseElement) {
                totalExpenseElement.textContent = `‚Çπ${total.toLocaleString('en-IN')}`;
            }
        }
    });
    


        // Display the current date
        document.getElementById('current-date').textContent = new Date().toLocaleDateString();

        // Set user's full name from localStorage
        document.getElementById('user-name').textContent = 
            localStorage.getItem('userName') || 'User';

        // Logout function
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userName');
            window.location.href = 'login.html';
        }


        // Add your chart initialization code here
        // You might want to use a library like Chart.js or ApexCharts
   // Add to your existing script section
document.addEventListener('DOMContentLoaded', function() {
    const chatbotToggle = document.getElementById('chatbot-toggle');
    const chatbotContainer = document.getElementById('chatbot-container');
    const closeChat = document.getElementById('close-chat');
    const chatMessages = document.getElementById('chatbot-messages');

    // Initial greeting with options
    function showInitialGreeting() {
        const greeting = `
            <div class="message bot-message">
                Namaste! Welcome to Expense Tracker Support.
                <br><br>
                How can I help you today?
                <div class="option-buttons">
                    <button onclick="selectOption('budget')">üí∞ Budget Management</button>
                    <button onclick="selectOption('expense')">üìù Track Expenses</button>
                    <button onclick="selectOption('report')">üìä View Reports</button>
                    <button onclick="selectOption('help')">‚ùì Help & Support</button>
                </div>
            </div>
        `;
        chatMessages.innerHTML = greeting;
    }

    // Show options based on selection
    window.selectOption = function(option) {
        let response = '';
        let options = [];

        switch(option) {
            case 'budget':
                response = "What would you like to know about your budget?";
                options = [
                    { text: "‚ú® Set New Budget", value: "set_budget" },
                    { text: "üëÄ View Current Budget", value: "check_budget" },
                    { text: "üí° Get Budget Tips", value: "budget_tips" },
                    { text: "‚¨ÖÔ∏è Back to Main Menu", value: "main_menu" }
                ];
                break;

            case 'expense':
                response = "What would you like to do with expenses?";
                options = [
                    { text: "‚ûï Add New Expense", value: "add_expense" },
                    { text: "üìã View Categories", value: "view_categories" },
                    { text: "üìà View Analysis", value: "expense_analysis" },
                    { text: "‚¨ÖÔ∏è Back to Main Menu", value: "main_menu" }
                ];
                break;

            case 'report':
                response = "Which report would you like to see?";
                options = [
                    { text: "üìÖ Monthly Summary", value: "monthly_report" },
                    { text: "üìä Category Report", value: "category_report" },
                    { text: "‚¨áÔ∏è Download Report", value: "export_report" },
                    { text: "‚¨ÖÔ∏è Back to Main Menu", value: "main_menu" }
                ];
                break;

            case 'help':
                response = "How can I assist you?";
                options = [
                    { text: "üì± App Tutorial", value: "tutorial" },
                    { text: "üîí Account Settings", value: "account_help" },
                    { text: "üìû Contact Support", value: "contact_support" },
                    { text: "‚¨ÖÔ∏è Back to Main Menu", value: "main_menu" }
                ];
                break;
        }

        addMessage(response, 'bot', options);
    }

    // Handle sub-option selection
    window.handleSubOption = function(value) {
        let response = '';
        
        switch(value) {
            // Budget responses
            case 'set_budget':
                response = "To set a new budget:\n1. Go to Settings ‚öôÔ∏è\n2. Click on 'Budget Management'\n3. Enter your monthly budget\n4. Click Save\n\nNeed help finding it?";
                break;
            case 'check_budget':
                response = "Your Budget Overview:\n\nüí∞ Monthly Budget: ‚Çπ50,000\n‚úÖ Spent: ‚Çπ24,500\n‚≠ê Remaining: ‚Çπ25,500\n\nWould you like to see a detailed breakdown?";
                break;
            case 'budget_tips':
                response = "Smart Budgeting Tips:\n\n1. 50-30-20 Rule:\n   ‚Ä¢ 50% for needs\n   ‚Ä¢ 30% for wants\n   ‚Ä¢ 20% for savings\n\n2. Track daily expenses\n3. Set category limits\n4. Review weekly\n\nWant more tips?";
                break;

            // Expense responses
            case 'add_expense':
                response = "Adding a new expense is easy!\n\n1. Click the '+' button\n2. Enter amount\n3. Choose category\n4. Add description\n5. Save\n\nTry it now! Need help?";
                break;
            case 'view_categories':
                response = "Expense Categories:\n\nüçú Food & Dining\nüöó Transportation\nüõí Shopping\nüì± Bills & Utilities\nüé¨ Entertainment\nüíä Healthcare\n\nClick any category in the dashboard to see details!";
                break;
            case 'expense_analysis':
                response = "This Month's Top Expenses:\n\n1. üçú Food & Dining: ‚Çπ8,500\n2. üì± Bills: ‚Çπ6,000\n3. üõí Shopping: ‚Çπ5,000\n\nWant to see the full analysis?";
                break;

            // Report responses
            case 'monthly_report':
                response = "December 2024 Summary:\n\nüí∞ Total Budget: ‚Çπ50,000\nüí∏ Total Spent: ‚Çπ24,500\nüí´ Savings: ‚Çπ25,500\n\nBiggest category: Food & Dining\nWant to see more details?";
                break;
            case 'category_report':
                response = "Category Breakdown:\n\nüçú Food: 35%\nüì± Bills: 25%\nüõí Shopping: 20%\nüé¨ Others: 20%\n\nClick any category for detailed analysis!";
                break;
            case 'export_report':
                response = "Export Options:\n\nüìë PDF Report\nüìä Excel Sheet\nüìà CSV File\n\nGo to Reports section and click 'Export' to download!";
                break;

            // Help responses
            case 'tutorial':
                response = "Welcome to the Tutorial!\n\nWould you like to learn about:\n1. Adding expenses\n2. Setting budgets\n3. Viewing reports\n4. Account settings\n\nClick any option to start!";
                break;
            case 'account_help':
                response = "Account Settings Help:\n\nüîê Change password\nüë§ Update profile\nüîî Manage notifications\nüì± Device settings\n\nNeed help with any of these?";
                break;
            case 'contact_support':
                response = "Contact Us:\n\nüìß Email: support@expensetracker.com\n‚òéÔ∏è Phone: 1800-XXX-XXXX\n‚è∞ Hours: 9 AM - 6 PM\n\nTypical response time: 24 hours";
                break;

            case 'main_menu':
                showInitialGreeting();
                return;
        }

        addMessage(response, 'bot', [
            { text: "‚¨ÖÔ∏è Back to Main Menu", value: "main_menu" }
        ]);
    }

    // Enhanced addMessage function
    function addMessage(text, sender, options = null) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', `${sender}-message`);
        messageDiv.innerHTML = text.replace(/\n/g, '<br>');

        if (options) {
            const buttonContainer = document.createElement('div');
            buttonContainer.classList.add('option-buttons');
            options.forEach(option => {
                const button = document.createElement('button');
                button.innerHTML = option.text;
                button.onclick = () => handleSubOption(option.value);
                buttonContainer.appendChild(button);
            });
            messageDiv.appendChild(buttonContainer);
        }

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Event Listeners
    chatbotToggle.addEventListener('click', () => {
        chatbotContainer.style.display = 'flex';
        showInitialGreeting();
    });

    closeChat.addEventListener('click', () => {
        chatbotContainer.style.display = 'none';
    })
});
const style = document.createElement('style');
style.textContent = `
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }

    .empty-state i {
        font-size: 48px;
        color: #ddd;
        margin-bottom: 10px;
    }

    .empty-state p {
        font-size: 18px;
        margin: 10px 0 5px;
    }

    .empty-state small {
        color: #999;
    }

    .no-transactions {
        background: #f9f9f9;
    }
`;
document.head.appendChild(style);
   </script>
    <!-- Chatbot Container -->
<div class="chatbot-container" id="chatbot-container">
    <div class="chatbot-header">
        <h3>Support Chat</h3>
        <button id="close-chat">√ó</button>
    </div>
    <div class="chatbot-messages" id="chatbot-messages">
        <div class="message bot-message">
            Hello! How can I help you today?
        </div>
    </div>
    <div class="chatbot-input">
        <input type="text" id="user-input" placeholder="Type your message...">
        <button id="send-message">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>

<!-- Chatbot Toggle Button -->
<div class="chatbot-toggle" id="chatbot-toggle">
    <i class="fas fa-comments"></i>
</div>

<!-- Add this modal HTML after your main dashboard content -->
<div id="expenseModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New Expense</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="add-expense-form">
            <form id="expenseForm">
                <div class="form-group">
                    <label for="expenseAmount">Amount (‚Çπ)</label>
                    <input type="number" id="expenseAmount" required>
                </div>

                <div class="form-group">
                    <label for="expenseCategory">Category</label>
                    <select id="expenseCategory" required>
                        <option value="">Select Category</option>
                        <option value="Food">Food & Dining</option>
                        <option value="Transportation">Transportation</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Bills">Bills & Utilities</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Others">Others</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="expenseDate">Date</label>
                    <input type="date" id="expenseDate" required>
                </div>

                <div class="form-group">
                    <label for="expenseDescription">Description</label>
                    <input type="text" id="expenseDescription" required>
                </div>

                <button type="submit" class="submit-btn">Add Expense</button>
            </form>
        </div>
    </div>
</div>

<!-- Add this JavaScript to update the metrics -->
<script>
function updateMetrics() {
    const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    
    // Calculate totals
    let totalIncome = 0;
    let totalExpenses = 0;

    transactions.forEach(transaction => {
        const amount = parseFloat(transaction.amount);
        if (transaction.type === 'income') {
            totalIncome += amount;
        } else {
            totalExpenses += amount;
        }
    });

    // Calculate remaining balance
    const remainingBalance = totalIncome - totalExpenses;

    // Update the display
    document.getElementById('total-income').textContent = 
        `‚Çπ${totalIncome.toLocaleString('en-IN')}`;
    document.getElementById('total-expenses').textContent = 
        `‚Çπ${totalExpenses.toLocaleString('en-IN')}`;
    document.getElementById('remaining-balance').textContent = 
        `‚Çπ${remainingBalance.toLocaleString('en-IN')}`;

    // Add color coding for balance
    const balanceElement = document.getElementById('remaining-balance');
    if (remainingBalance < 0) {
        balanceElement.style.color = '#dc3545'; // Red for negative
    } else {
        balanceElement.style.color = '#28a745'; // Green for positive
    }
}

// Call updateMetrics when page loads and after any transaction changes
document.addEventListener('DOMContentLoaded', updateMetrics);

// Update metrics whenever localStorage changes (if on the same page)
window.addEventListener('storage', updateMetrics);
</script>

<!-- Add this JavaScript for the pie chart -->
<script>
function updateExpenseChart() {
    const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    let totalIncome = 0;
    let expensesByCategory = {};
    
    // Calculate totals
    transactions.forEach(transaction => {
        const amount = parseFloat(transaction.amount);
        if (transaction.type === 'income') {
            totalIncome += amount;
        } else {
            // Initialize category if it doesn't exist
            if (!expensesByCategory[transaction.category]) {
                expensesByCategory[transaction.category] = 0;
            }
            expensesByCategory[transaction.category] += amount;
        }
    });

    // Calculate total expenses
    const totalExpenses = Object.values(expensesByCategory).reduce((a, b) => a + b, 0);
    
    // Calculate remaining balance
    const remaining = Math.max(0, totalIncome - totalExpenses);

    // Define colors for categories
    const categoryColors = {
        housing: '#ff6384',
        food: '#36a2eb',
        transportation: '#ffce56',
        health: '#4bc0c0',
        entertainment: '#9966ff',
        shopping: '#ff9f40',
        travel: '#ea80fc',
        savings: '#90caf9',
        gifts: '#81c784',
        miscellaneous: '#f48fb1',
        debt: '#ce93d8'
    };

    // Prepare data for the chart
    const chartData = {
        labels: [
            'Remaining Balance',
            ...Object.keys(expensesByCategory).map(category => 
                category.charAt(0).toUpperCase() + category.slice(1)
            )
        ],
        datasets: [{
            data: [
                remaining,
                ...Object.values(expensesByCategory)
            ],
            backgroundColor: [
                '#28a745', // Green for remaining balance
                ...Object.keys(expensesByCategory).map(category => 
                    categoryColors[category] || '#999999'
                )
            ]
        }]
    };

    // Chart configuration
    const config = {
        type: 'pie',
        data: chartData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {
                        color: '#333',
                        font: {
                            size: 12
                        },
                        generateLabels: function(chart) {
                            const data = chart.data;
                            if (data.labels.length && data.datasets.length) {
                                return data.labels.map((label, i) => {
                                    const value = data.datasets[0].data[i];
                                    const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return {
                                        text: `${label} (‚Çπ${value.toLocaleString('en-IN')}) ${percentage}%`,
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        hidden: isNaN(value) || value === 0,
                                        index: i
                                    };
                                });
                            }
                            return [];
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const value = context.raw;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `‚Çπ${value.toLocaleString('en-IN')} (${percentage}%)`;
                        }
                    }
                }
            }
        }
    };

    // Get the chart context
    const ctx = document.getElementById('expense-chart').getContext('2d');
    
    // Destroy existing chart if it exists
    if (window.expenseChart instanceof Chart) {
        window.expenseChart.destroy();
    }
    
    // Create new chart
    window.expenseChart = new Chart(ctx, config);

    // Update trend chart
    updateTrendChart();
}

function updateTrendChart() {
    const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    const monthlyData = {};

    // Process transactions by month
    transactions.forEach(transaction => {
        const date = new Date(transaction.date);
        const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
        
        if (!monthlyData[monthKey]) {
            monthlyData[monthKey] = {
                income: 0,
                expenses: 0
            };
        }

        const amount = parseFloat(transaction.amount);
        if (transaction.type === 'income') {
            monthlyData[monthKey].income += amount;
        } else {
            monthlyData[monthKey].expenses += amount;
        }
    });

    // Sort months and prepare chart data
    const sortedMonths = Object.keys(monthlyData).sort();
    const chartData = {
        labels: sortedMonths.map(month => {
            const [year, monthNum] = month.split('-');
            return new Date(year, monthNum - 1).toLocaleDateString('en-IN', { month: 'short', year: 'numeric' });
        }),
        datasets: [
            {
                label: 'Income',
                data: sortedMonths.map(month => monthlyData[month].income),
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.2)',
                fill: true
            },
            {
                label: 'Expenses',
                data: sortedMonths.map(month => monthlyData[month].expenses),
                borderColor: '#dc3545',
                backgroundColor: 'rgba(220, 53, 69, 0.2)',
                fill: true
            }
        ]
    };

    const config = {
        type: 'line',
        data: chartData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: value => '‚Çπ' + value.toLocaleString('en-IN')
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': ‚Çπ' + 
                                context.raw.toLocaleString('en-IN');
                        }
                    }
                }
            }
        }
    };

    const ctx = document.getElementById('trend-chart').getContext('2d');
    
    if (window.trendChart instanceof Chart) {
        window.trendChart.destroy();
    }
    
    window.trendChart = new Chart(ctx, config);
}

// Make sure to call updateExpenseChart when transactions change
document.addEventListener('DOMContentLoaded', function() {
    updateExpenseChart();
});

// Update chart when new transactions are added
window.addEventListener('storage', function(e) {
    if (e.key === 'transactions') {
        updateExpenseChart();
    }
});

// Add this to your existing transaction save function
function saveTransaction(transaction) {
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    transactions.push(transaction);
    localStorage.setItem('transactions', JSON.stringify(transactions));
    updateExpenseChart(); // Update chart after saving
}

<!-- Update the recent transactions function -->
function updateRecentTransactions() {
    const transactionsBody = document.getElementById('recent-transactions-body');
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    
    // Sort transactions by date (most recent first)
    const sortedTransactions = transactions.sort((a, b) => 
        new Date(b.date) - new Date(a.date)
    );

    // Take only the 4 most recent transactions
    const recentTransactions = sortedTransactions.slice(0, 4);

    // Clear existing transactions
    transactionsBody.innerHTML = '';

    // If no transactions, show message
    if (recentTransactions.length === 0) {
        transactionsBody.innerHTML = `
            <tr>
                <td colspan="5" class="no-transactions">
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>No transactions found</p>
                        <small>Add your first transaction to get started</small>
                    </div>
                </td>
            </tr>
        `;
        return;
    }

    // Add transactions to table
    recentTransactions.forEach(transaction => {
        const row = document.createElement('tr');
        const amount = parseFloat(transaction.amount);
        
        row.innerHTML = `
            <td>${formatDate(transaction.date)}</td>
            <td>${transaction.description || '-'}</td>
            <td>${formatCategory(transaction.category)}</td>
            <td>
                <span class="transaction-type ${transaction.type}">
                    ${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)}
                </span>
            </td>
            <td class="amount ${transaction.type}">
                ${transaction.type === 'income' ? '+' : '-'}‚Çπ${amount.toLocaleString('en-IN')}
            </td>
        `;
        
        transactionsBody.appendChild(row);
    });
}

// Add this CSS for better empty state styling


// Initialize on page load
document.addEventListener('DOMContentLoaded', updateRecentTransactions);

// Update when storage changes
window.addEventListener('storage', (e) => {
    if (e.key === 'transactions') {
        updateRecentTransactions();
    }
});
// Add to your existing JavaScript
const PerformanceOptimizer = {
    lazyLoadImages: function() {
        const images = document.querySelectorAll('img[data-src]');
        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    imageObserver.unobserve(img);
                }
            });
        });
        images.forEach(img => imageObserver.observe(img));
    },

    cacheAPIData: function(key, data, duration = 3600000) {
        localStorage.setItem(key, JSON.stringify({
            data,
            timestamp: Date.now(),
            expiry: Date.now() + duration
        }));
    },

    getCachedData: function(key) {
        const cached = JSON.parse(localStorage.getItem(key));
        if (cached && Date.now() < cached.expiry) {
            return cached.data;
        }
        return null;
    }
};
</script>

</body>
</html>